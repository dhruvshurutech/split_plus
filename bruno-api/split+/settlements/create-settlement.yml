info:
  name: create-settlement
  type: http
  seq: 1

http:
  method: POST
  url: "{{base_url}}/groups/{{group_id}}/settlements"
  headers:
    - name: X-User-ID
      value: "{{user_id}}"
  body:
    type: json
    data: |-
      {
        "payer_id": "{{invite_user_id}}",
        "payee_id": "{{user_id}}",
        "amount": "375.00",
        "currency_code": "INR",
        "status": "pending",
        "payment_method": "cash",
        "transaction_reference": "",
        "notes": "Settling dinner expense"
      }
  auth: inherit

settings:
  encodeUrl: true
  timeout: 0
  followRedirects: true
  maxRedirects: 5

docs: |
  # Create Settlement

  Record a payment between two users in a group.

  ## Authentication
  Requires `X-User-ID` header with a valid user UUID (must be a group member).

  ## Path Parameters
  - `group_id`: UUID of the group (use `{{group_id}}` variable)

  ## Request Body
  - `payer_id` (required): UUID of the user who is paying
  - `payee_id` (required): UUID of the user who is receiving payment
  - `amount` (required): Payment amount (must be positive)
  - `currency_code` (optional): 3-letter currency code (defaults to group currency)
  - `status` (optional): Settlement status ("pending", "completed", "cancelled") - defaults to "pending"
  - `payment_method` (optional): Payment method (e.g., "cash", "card", "bank_transfer")
  - `transaction_reference` (optional): Transaction reference number
  - `notes` (optional): Additional notes about the settlement

  ## Validation Rules
  - Payer and payee must be different users
  - Payer and payee must both be group members
  - Amount must be positive

  ## Response
  Returns the created settlement with:
  - `id`: Settlement UUID (save this to `settlement_id` variable)
  - `group_id`: Group UUID
  - `payer_id`: Payer user UUID
  - `payee_id`: Payee user UUID
  - `amount`: Payment amount
  - `currency_code`: Currency code
  - `status`: Settlement status
  - `payment_method`: Payment method
  - `transaction_reference`: Transaction reference
  - `paid_at`: Timestamp when marked as completed (null if pending)
  - `notes`: Notes
  - `created_at`: Creation timestamp
  - `created_by`: User who created the settlement

  ## Status Codes
  - `201 Created`: Settlement successfully created
  - `401 Unauthorized`: Missing or invalid user ID
  - `403 Forbidden`: User is not a group member
  - `400 Bad Request`: Invalid request data (payer == payee, invalid amount, etc.)
  - `404 Not Found`: Group not found

  ## Notes
  - After creating a settlement, copy the `id` from the response and set it as the `settlement_id` environment variable.
  - Settlements are separate from balance calculations (for now)
  - Use this to track actual payments made between users
