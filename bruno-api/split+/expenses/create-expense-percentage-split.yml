info:
  name: create-expense-percentage-split
  type: http
  seq: 4

http:
  method: POST
  url: "{{base_url}}/groups/{{group_id}}/expenses"
  auth: none
  headers:
    - name: Authorization
      value: "Bearer {{access_token}}"
      enabled: true
  body:
    type: json
    data: |-
      {
        "title": "Office Supplies - Business Partnership",
        "notes": "Shared office supplies cost split by partnership ownership percentages",
        "amount": "1000.00",
        "date": "2026-01-31",
        "payments": [
          {
            "user_id": "{{user_id}}",
            "amount": "1000.00",
            "payment_method": "card"
          }
        ],
        "splits": [
          {
            "user_id": "{{user_id}}",
            "type": "percentage",
            "percentage": "60.00"
          },
          {
            "user_id": "{{invite_user_id}}",
            "type": "percentage",
            "percentage": "40.00"
          }
        ]
      }

settings:
  encodeUrl: true
  timeout: 0
  followRedirects: true
  maxRedirects: 5

docs: |
  # Percentage Split Example

  A percentage split divides the expense based on ownership or responsibility percentages. The backend automatically calculates the dollar amounts from percentages.

  ## When to Use
  - Business partnerships with percentage ownership
  - Proportional cost sharing
  - Equity-based expense splits
  - Projects where contributions are weighted differently
  - Scenarios where someone has 60%/40% responsibility

  ## Calculation Logic (Backend)
  The backend automatically calculates dollar amounts from percentages:
  - **Total Amount**: $1000.00
  - **Partner A Percentage**: 60%
  - **Partner B Percentage**: 40%
  - **Backend Calculates**: Partner A = $1000 × 60% = $600.00, Partner B = $1000 × 40% = $400.00

  **Another Example with 3 Partners:**
  - **Total Amount**: $300.00
  - **Partner A**: 50% → Backend calculates $150.00
  - **Partner B**: 33.33% → Backend calculates $99.99
  - **Partner C**: 16.67% → Backend calculates $50.01 (adjusted)
  - **Total**: $150.00 + $99.99 + $50.01 = $300.00 ✓

  ## Important Notes
  - Set `"type": "percentage"` for each split
  - Provide the `"percentage"` field (e.g., "60.00" for 60%)
  - Do NOT provide `amount` or `shares` fields
  - Percentages MUST sum to exactly 100.00
  - The backend calculates and returns the `amount_owned` for each participant
  - All split user_ids must be group members
  - At least one split is required
  - All splits must have the same type (no mixing percentage with equal, etc.)

  ## Validation Rules
  - All splits must have type "percentage"
  - Percentages must sum to exactly 100.00
  - Cannot mix split types in one expense
  - Each percentage must be > 0
  - Each split must reference a valid group member
  - Payment total must equal expense amount

  ## Response
  Returns the created expense with:
  - `expense`: Expense object containing id, title, amount, etc.
  - `splits`: Array of split objects showing:
    - `amount_owned`: Backend-calculated dollar amount
    - `share_value`: The original percentage value (e.g., "60.00")

  ## Status Codes
  - `201 Created`: Expense successfully created with calculated splits
  - `422 Unprocessable Entity`: Percentages don't sum to 100 or invalid split configuration
  - `400 Bad Request`: Invalid request data (e.g., missing percentage field)
  - `401 Unauthorized`: Missing or invalid access token
  - `403 Forbidden`: User is not a group member

  ## Backend Calculation
  The backend handles all percentage-to-dollar conversions and rounding adjustments automatically. The last split is adjusted to ensure the total matches exactly.
