info:
  name: expenses
  type: folder
  seq: 3

request:
  auth: none

docs: |
  # Expenses API

  Endpoints for expense management, payments, and splits.

  ## Authentication
  All expense endpoints require Bearer token in Authorization header.

  ## Available Endpoints
  - **Create Expense (Equal Split)**: Team lunches, shared activities
  - **Create Expense (Fixed Split)**: Reimbursements, pre-agreed amounts
  - **Create Expense (Percentage Split)**: Business partnerships, proportional ownership
  - **Create Expense (Custom Split)**: Usage-based costs, hotel nights, data usage
  - **List Expenses**: Get all expenses for a group
  - **Get Expense**: Get expense details by ID
  - **Update Expense**: Update expense details, payments, and splits
  - **Delete Expense**: Soft delete an expense

  ## Understanding Expense Split Types

  The API supports 4 split types, each with different use cases. **IMPORTANT**: The `split_type` field is metadata only. The backend does NOT automatically calculate amounts—you must pre-calculate the amounts on the client side.

  ### 1. Equal Split
  **What**: Divides expense equally among all participants
  **When**: Team lunches, group dinners, shared activities
  **Example**: $120 lunch ÷ 3 people = $40 each
  **Client Responsibility**: Calculate $120 ÷ 3 = $40, then provide three splits with $40 each
  **Request File**: `create-expense-equal-split.yml`

  ### 2. Fixed Split
  **What**: Each person owes a pre-determined fixed amount (can be unequal)
  **When**: Reimbursements, pre-agreed amounts, rent sharing
  **Example**: Person A paid $750 for dinner, Person B owes the full amount
  **Client Responsibility**: Specify exact amounts for each person (e.g., Person A: $100, Person B: $50 for $150 expense)
  **Request File**: `create-expense-fixed-split.yml`

  ### 3. Percentage Split
  **What**: Splits based on ownership or responsibility percentages
  **When**: Business partnerships, equity-based splits, proportional cost sharing
  **Example**: $1000 supplies → Partner A (60%) owes $600, Partner B (40%) owes $400
  **Client Responsibility**: Calculate dollar amounts from percentages (60% of $1000 = $600, 40% of $1000 = $400)
  **Request File**: `create-expense-percentage-split.yml`

  ### 4. Custom Split
  **What**: Non-standard splits based on custom calculation criteria
  **When**: Hotel nights, data usage, item consumption, variable usage scenarios
  **Example**: $300 hotel → Person A (3 nights) owes $180, Person B (2 nights) owes $120
  **Client Responsibility**: Implement custom logic (e.g., $100/night × 3 nights = $180) and calculate amounts
  **Request File**: `create-expense-custom-split.yml`

  ## Critical: Pre-Calculated Amounts

  The backend **validates but does not calculate** split amounts. You must:
  1. Determine which split type matches your scenario
  2. Calculate the exact dollar amounts on the client side
  3. Provide pre-calculated `amount_owned` values for each split
  4. Ensure all amounts total to the expense amount exactly

  **Validation Example**:
  - Request expense amount: $100.00
  - Sum of payment amounts: must equal $100.00
  - Sum of split amounts: must equal $100.00
  - If amounts don't match, API returns 422 error

  ## Workflow
  1. Create a group and save the `id` to `group_id` variable
  2. Determine the appropriate split type for your scenario
  3. Calculate the amounts on your client side
  4. Create an expense with payments and pre-calculated splits
  5. Save the expense `id` to `expense_id` variable
  6. List or update expenses as needed

  ## Important Requirements
  - All expenses must have at least one payment (total must equal expense amount)
  - All expenses must have at least one split (total must equal expense amount)
  - Only group members can create/view expenses
  - Payments represent who paid for the expense
  - Splits represent who owes what portion of the expense
  - All split user_ids must be group members
  - Use decimal strings for amounts (e.g., "40.00", not 40)
  - For non-divisible amounts, adjust the last split to ensure exact total
