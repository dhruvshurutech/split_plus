info:
  name: create-expense-equal-split
  type: http
  seq: 2

http:
  method: POST
  url: "{{base_url}}/groups/{{group_id}}/expenses"
  headers:
    - name: Authorization
      value: Bearer {{access_token}}
  body:
    type: json
    data: |-
      {
        "title": "Team Lunch at Pizza Place",
        "notes": "Lunch with the team - split equally among everyone",
        "amount": "120.00",
        "date": "2026-01-31",
        "category_id": "{{category_id}}",
        "payments": [
          {
            "user_id": "{{user_id}}",
            "amount": "120.00",
            "payment_method": "card"
          }
        ],
        "splits": [
          {
            "user_id": "{{user_id}}",
            "type": "equal"
          },
          {
            "user_id": "{{invite_user_id}}",
            "type": "equal"
          }
        ]
      }

runtime:
  variables:
    - name: category_id
      value: 827d0d2b-ea53-4700-9e3d-3177d6898fc4

settings:
  encodeUrl: true
  timeout: 0
  followRedirects: true
  maxRedirects: 5

docs: |
  # Equal Split Example

  An equal split divides the expense amount equally among all participants. The backend automatically calculates the per-person amount.

  ## When to Use
  - Team lunches or dinners
  - Group activities (movie night, game night, etc.)
  - Shared household expenses
  - Any scenario where participants should pay the same amount

  ## Calculation Logic (Backend)
  The backend automatically calculates equal splits:
  - **Total Amount**: $120.00
  - **Number of Participants**: 3
  - **Backend Calculates**: $120.00 รท 3 = $40.00 each

  For amounts that don't divide evenly, the backend adjusts the last person's amount to ensure the total matches exactly.

  **Example with rounding:**
  - **Total Amount**: $100.00
  - **Number of Participants**: 3
  - **Backend Calculation**: Person A: $33.33, Person B: $33.33, Person C: $33.34 (adjusted to total $100.00)

  ## Important Notes
  - Set `"type": "equal"` for each split
  - Do NOT provide `amount`, `percentage`, or `shares` fields
  - The backend calculates and returns the `amount_owned` for each participant
  - All split user_ids must be group members
  - At least one split is required
  - All splits must have the same type (no mixing equal with percentage, etc.)

  ## Validation Rules
  - All splits must have type "equal"
  - Cannot mix split types in one expense
  - Each split must reference a valid group member
  - Payment total must equal expense amount

  ## Response
  Returns the created expense with:
  - `expense`: Expense object containing id, title, amount, etc.
  - `splits`: Array of split objects showing the backend-calculated `amount_owned` for each person
    - Each split includes `share_value: null` (not applicable for equal splits)

  ## Status Codes
  - `201 Created`: Expense successfully created with calculated splits
  - `422 Unprocessable Entity`: Invalid split configuration
  - `400 Bad Request`: Invalid request data (e.g., missing type field)
  - `401 Unauthorized`: Missing or invalid access token
  - `403 Forbidden`: User is not a group member
