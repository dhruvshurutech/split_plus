info:
  name: create-expense
  type: http
  seq: 1

http:
  method: POST
  url: "{{base_url}}/groups/{{group_id}}/expenses"
  headers:
    - name: Authorization
      value: "Bearer {{access_token}}"
  body:
    type: json
    data: |-
      {
        "title": "Dinner at Chokhi",
        "notes": "Great food and service",
        "amount": "750.00",
        "date": "2026-01-19",
        "category_id": "{{category_id}}",
        "tags": ["food", "dinner"],
        "payments": [
          {
            "user_id": "{{user_id}}",
            "amount": "750.00",
            "payment_method": "card"
          }
        ],
        "splits": [
          {
            "user_id": "{{invite_user_id}}",
            "type": "fixed",
            "amount": "750.00"
          }
        ]
      }
  auth: none

settings:
  encodeUrl: true
  timeout: 0
  followRedirects: true
  maxRedirects: 5

docs: |
  # Create Expense

  Creates a new expense with payments and splits.

  ## Authentication
  Requires `Authorization: Bearer {access_token}` header with a valid JWT token.

  ## Path Parameters
  - `group_id`: UUID of the group (use `{{group_id}}` variable)

  ## Request Body
  - `title` (required): Expense title (1-200 characters)
  - `notes` (optional): Additional notes about the expense (max 1000 characters)
  - `amount` (required): Total expense amount (must be positive)
  - `currency_code`: Ignored for group expenses (uses group currency_code)
  - `date` (required): Expense date in YYYY-MM-DD format
  - `category_id` (optional): UUID of the expense category
  - `tags` (optional): Array of tag strings
  - `payments` (required): Array of payment objects
    - `user_id` (required): UUID of the user who paid
    - `amount` (required): Payment amount (must be positive)
    - `payment_method` (optional): Payment method (e.g., "cash", "card", "online")
  - `splits` (required): Array of split objects
    - `user_id` (required): UUID of the user who owes
    - `type` (required): Split type ("equal", "percentage", "shares", "fixed", "custom")
    - `amount` (conditional): Amount owed - required for "fixed" and "custom" types
    - `percentage` (conditional): Percentage value - required for "percentage" type
    - `shares` (conditional): Number of shares - required for "shares" type

  ## Split Types
  - **equal**: Equal split among all members. No additional fields needed.
  - **fixed**: Fixed amount per person. Requires `amount` field.
  - **percentage**: Percentage-based split. Requires `percentage` field (e.g., "50.00").
  - **shares**: Share-based split. Requires `shares` field (integer).
  - **custom**: Custom amount per person. Requires `amount` field.

  ## Validation Rules
  - Payment amounts must total to expense amount
  - Split amounts must total to expense amount
  - All payment and split user_ids must be group members
  - For percentage splits: percentages must sum to 100
  - For shares splits: shares must be positive integers

  ## Response
  Returns the created expense with:
  - `expense`: Expense object with id, title, amount, currency, date, category_id, tags, etc.
  - `payments`: Array of payment objects with user details
  - `splits`: Array of split objects with user details

  ## Status Codes
  - `201 Created`: Expense successfully created
  - `401 Unauthorized`: Missing or invalid access token
  - `403 Forbidden`: User is not a group member
  - `422 Unprocessable Entity`: Validation errors (amount mismatch, percentage error, etc.)
  - `400 Bad Request`: Invalid request data

  ## Notes
  - After creating an expense, copy the `id` from the response and set it as the `expense_id` environment variable.
  - Payment total must exactly equal expense amount
  - Split total must exactly equal expense amount
  - Multiple users can pay for a single expense (split payments)
