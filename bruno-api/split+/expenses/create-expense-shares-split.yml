info:
  name: create-expense-shares-split
  type: http
  seq: 6

http:
  method: POST
  url: "{{base_url}}/groups/{{group_id}}/expenses"
  auth: none
  headers:
    - name: Authorization
      value: "Bearer {{access_token}}"
      enabled: true
  body:
    type: json
    data: |-
      {
        "title": "Apartment Rent - Roommate Split",
        "notes": "Rent split based on room sizes (2 shares for master bedroom, 1 share for small room)",
        "amount": "1500.00",
        "date": "2026-01-31",
        "payments": [
          {
            "user_id": "{{user_id}}",
            "amount": "1500.00",
            "payment_method": "bank_transfer"
          }
        ],
        "splits": [
          {
            "user_id": "{{user_id}}",
            "type": "shares",
            "shares": 2
          },
          {
            "user_id": "{{invite_user_id}}",
            "type": "shares",
            "shares": 1
          }
        ]
      }

settings:
  encodeUrl: true
  timeout: 0
  followRedirects: true
  maxRedirects: 5

docs: |
  # Shares Split Example

  A shares split divides the expense proportionally based on share counts. The backend automatically calculates the dollar amounts based on share proportions.

  ## When to Use
  - Rent splits based on room sizes
  - Resource sharing based on usage units
  - Cost allocation based on ownership stakes
  - Any scenario where splits are proportional but not percentage-based

  ## Calculation Logic (Backend)
  The backend automatically calculates amounts from share proportions:
  - **Total Amount**: $1500.00
  - **Person A Shares**: 2 (master bedroom)
  - **Person B Shares**: 1 (small room)
  - **Total Shares**: 2 + 1 = 3
  - **Backend Calculates**:
    - Person A = $1500 × (2/3) = $1000.00
    - Person B = $1500 × (1/3) = $500.00

  **Another Example with 3 People:**
  - **Total Amount**: $600.00
  - **Person A**: 3 shares → Backend calculates $300.00
  - **Person B**: 2 shares → Backend calculates $200.00
  - **Person C**: 1 share → Backend calculates $100.00
  - **Total**: $300 + $200 + $100 = $600.00 ✓

  ## Important Notes
  - Set `"type": "shares"` for each split
  - Provide the `"shares"` field as an integer (e.g., 2 for 2 shares)
  - Do NOT provide `amount` or `percentage` fields
  - Shares must be integers > 0
  - The backend calculates and returns the `amount_owned` for each participant
  - All split user_ids must be group members
  - At least one split is required
  - All splits must have the same type (no mixing shares with equal, etc.)

  ## Validation Rules
  - All splits must have type "shares"
  - Each shares value must be an integer > 0
  - Cannot mix split types in one expense
  - Each split must reference a valid group member
  - Payment total must equal expense amount

  ## Response
  Returns the created expense with:
  - `expense`: Expense object containing id, title, amount, etc.
  - `splits`: Array of split objects showing:
    - `amount_owned`: Backend-calculated dollar amount
    - `share_value`: The original share count (e.g., "2" for 2 shares)

  ## Status Codes
  - `201 Created`: Expense successfully created with calculated splits
  - `422 Unprocessable Entity`: Invalid shares or split configuration
  - `400 Bad Request`: Invalid request data (e.g., missing shares field)
  - `401 Unauthorized`: Missing or invalid access token
  - `403 Forbidden`: User is not a group member

  ## Difference from Percentage Split
  Shares are simpler than percentages - just specify integer counts and the backend calculates the proportions. Perfect for scenarios like room sizes (2 shares, 1 share) without needing to calculate percentages manually.

  ## Backend Calculation
  The backend handles all share-to-dollar conversions and rounding adjustments automatically. The last split is adjusted to ensure the total matches exactly.
