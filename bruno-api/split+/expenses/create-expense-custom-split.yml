info:
  name: create-expense-custom-split
  type: http
  seq: 5

http:
  method: POST
  url: "{{base_url}}/groups/{{group_id}}/expenses"
  auth: none
  headers:
    - name: Authorization
      value: "Bearer {{access_token}}"
      enabled: true
  body:
    type: json
    data: |-
      {
        "title": "Grocery Shopping - Unequal Items",
        "notes": "Bought different items for different people",
        "amount": "85.50",
        "date": "2026-01-31",
        "payments": [
          {
            "user_id": "{{user_id}}",
            "amount": "85.50",
            "payment_method": "cash"
          }
        ],
        "splits": [
          {
            "user_id": "{{user_id}}",
            "type": "custom",
            "amount": "45.50"
          },
          {
            "user_id": "{{invite_user_id}}",
            "type": "custom",
            "amount": "40.00"
          }
        ]
      }

settings:
  encodeUrl: true
  timeout: 0
  followRedirects: true
  maxRedirects: 5

docs: |
  # Custom Split Example

  A custom split uses pre-determined, specific amounts for each person (similar to fixed split). The backend validates that the amounts sum to the total.

  ## When to Use
  - Non-standard expense splits
  - Different items purchased for different people
  - Arbitrary or unique split arrangements
  - When you want to semantically indicate a custom split arrangement

  ## Validation Logic (Backend)
  The backend validates that custom amounts sum to the total:
  - **Total Amount**: $85.50
  - **Person A Custom Amount**: $45.50
  - **Person B Custom Amount**: $40.00
  - **Backend Validates**: $45.50 + $40.00 = $85.50 ✓

  ## Important Notes
  - Set `"type": "custom"` for each split
  - Provide the `"amount"` field with the exact amount
  - Do NOT provide `percentage` or `shares` fields
  - Split amounts MUST sum to exactly the expense total
  - The backend validates (not calculates) the amounts
  - All split user_ids must be group members
  - At least one split is required
  - All splits must have the same type (no mixing custom with equal, etc.)

  ## Validation Rules
  - All splits must have type "custom"
  - Split amounts must sum to exactly the expense amount
  - Cannot mix split types in one expense
  - Each amount must be ≥ 0
  - Each split must reference a valid group member
  - Payment total must equal expense amount

  ## Response
  Returns the created expense with:
  - `expense`: Expense object containing id, title, amount, etc.
  - `splits`: Array of split objects showing:
    - `amount_owned`: The custom amount you provided
    - `share_value`: null (not applicable for custom splits)

  ## Status Codes
  - `201 Created`: Expense successfully created with validated splits
  - `422 Unprocessable Entity`: Split amounts don't sum to expense amount
  - `400 Bad Request`: Invalid request data (e.g., missing amount field)
  - `401 Unauthorized`: Missing or invalid access token
  - `403 Forbidden`: User is not a group member

  ## Difference from Fixed Split
  Custom and fixed splits work identically - both require explicit amounts. The "custom" type is just semantic metadata to indicate a non-standard split arrangement, while "fixed" typically indicates pre-agreed amounts.
